#!/bin/bash

unset SSH_AGENT_PID

if [ "${gnupg_SSH_AUTH_SOCK_by:-0}" -ne $$ ]; then
  export SSH_AUTH_SOCK="$(gpgconf --list-dirs agent-ssh-socket)"
fi

export GPG_TTY=$(tty)

gpgconf --launch gpg-agent

# Update tty in gpg agent
gpg-connect-agent updatestartuptty /bye > /dev/null

# Passphrase prompt
echo "1234" | gpg -q --batch --status-fd 1 --sign --local-user {{ .email }} --passphrase-fd 0 > /dev/null && echo ok

echo "Gpg started!"
